<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>現在の状態</title>
    <style>
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(4, auto); /* ← 中身の幅に合わせる */
            gap: 12px;
            justify-content: start; /* ← 左寄せ */
            margin-bottom: 40px;
        }

        .calendar-item {
            padding: 4px;
            border: 1px solid #ccc;
            background-color: #fdfdfd;
            box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.05);
            display: inline-block;
        }

        .calendar-item table {
            table-layout: auto;
        }

        .calendar-item th, .calendar-item td {
            text-align: center;
            padding: 2px;
        }
    </style>


</head>
<body>
    <h2>現在のライト状態</h2>

    {% if status %}
        <div class="light {{ 'on-red' if status.red == '点灯' else 'off-red' }}">
            {{ status.red }}
        </div>
        <div class="light {{ 'on-yellow' if status.yellow == '点灯' else 'off-yellow' }}">
            {{ status.yellow }}
        </div>
        <div class="light {{ 'on-green' if status.green == '点灯' else 'off-green' }}">
            {{ status.green }}
        </div>
        <p>データ取得時刻：{{ status.timestamp }}</p>
    {% else %}
        <p>利用可能なデータがありません（過去5分以内）</p>
    {% endif %}
    
    <h2>閾値設定</h2>
    <p>赤: {{ thresholds.red }}ルクス より大きい場合、点灯判定</p>
    <p>黄: {{ thresholds.yellow }}ルクス より大きい場合、点灯判定</p>
    <p>緑: {{ thresholds.green }}ルクス より大きい場合、点灯判定</p>

    <h2>年度カレンダー（{{ calendar|length }}ヶ月分）</h2>

    <div class="calendar-grid">
        {% for ym, data in calendar.items() %}
        <div class="calendar-item">
            <h3>
                {% if data.month_link %}
                    <a href="/month/{{ ym }}/graph">{{ ym }}</a>
                {% else %}
                    {{ ym }}
                {% endif %}
            </h3>
            <table border="1" cellspacing="0" cellpadding="4">
                <tr>
                    <th>月</th><th>火</th><th>水</th><th>木</th><th>金</th><th>土</th><th>日</th>
                </tr>
                {% for week in data.weeks %}
                <tr>
                    {% for day in week %}
                        {% if day is none %}
                            <td></td>
                        {% else %}
                            <td>
                                {% if day.link %}
                                    <a href="/date/{{ day.date }}/graph">{{ day.day }}</a>
                                {% else %}
                                    {{ day.day }}
                                {% endif %}
                            </td>
                        {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endfor %}
    </div>
</body>
</html>
